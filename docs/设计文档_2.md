# 棋类对战平台（改动说明）

本说明仅记录在“第一阶段”基础上的增量修改，围绕四个问题进行修复与优化。

## 1. 主题切换需点击两次的问题

- 问题：切换主题（如 wood→light）后，点击“开始新对局”仍沿用旧主题，需要再次点击才生效。
- 原因：UI 中先创建新对局再更新主题，渲染时取的是旧主题。
- 处理：
  - 在 ui/app_ui.py 的 start_game 回调中，先调用 ctl.set_theme(th) 再创建新对局。
  - 在 UIController 中新增 set_theme，同步更新渲染器与控制器的 theme。
  - 渲染器 ImageRenderer 新增 set_theme 以立即生效。

影响文件：
- ui/app_ui.py
- ui/controller.py
- ui/renderer.py

## 2. 胜负弹窗与结束后继续点击提示

- 需求：
  - 终局（连五、认负、双方虚着结算）时弹出中文提示：“哪方获胜，请开启新对局。”
  - 终局后若用户再在棋盘点击，应提示“对局已结束，请开启新对局。”
- 实现：
  - 控制器方法（click_canvas/do_pass/resign/undo）统一返回 (image, popup)。
  - 使用 Gradio 的 gr.Warning 展示中文弹窗。
  - 在 click_canvas 中对 game.ended 进行拦截，返回结束提示。
  - 围棋结算时根据 score 结果给出具体胜负中文提示；五子棋与认负根据 winner 提示。

影响文件：
- ui/app_ui.py
- ui/controller.py
- core/gomoku.py（允许认负）
- core/go.py（认负与双虚着终局）

## 3. Pillow 渲染文字统一改为英文

- 背景：Pillow 在在线环境可能缺少中文字体导致渲染方块/乱码。
- 处理：
  - 将渲染到图片中的消息、当前手、终局文字全部改为英文（UI 组件与弹窗依然使用中文）。
  - UIController 的 message、_turn_label 产出英文文本；Renderer 仅绘制英文。
  - 所有用户可见的中文提示（弹窗、按钮、标签）保留不变。

影响文件：
- ui/controller.py
- ui/renderer.py

## 4. 取消用户上传棋盘图片，默认渲染 19×19 围棋盘

- 处理：
  - 去除任何上传外部图片的入口（原实现无上传功能，仅确认 Image 不接收外源）。
  - 在 demo.load 时自动初始化为 19×19 围棋对局并渲染，使页面打开即显示默认棋盘。

影响文件：
- ui/app_ui.py

## 验收要点

- 切换主题后，首次“开始新对局”即使用所选主题。
- 达成胜负或认负、双虚着后弹窗中文提示胜负并要求开启新对局。
- 对局结束后在棋盘任意点击，弹窗“对局已结束，请开启新对局。”
- 图片底部英文提示，UI 与弹窗中文。
- 页面打开即有 19×19 围棋盘显示，无需上传。